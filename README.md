# üöÄ ArgoCD GitOps Lab (k3s)

–î–∞–Ω–Ω—ã–π –ø—Ä–æ–µ–∫—Ç ‚Äî —ç—Ç–æ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –ø–æ **GitOps-–ø–æ–¥—Ö–æ–¥—É** —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º **ArgoCD** –≤ Kubernetes-–∫–ª–∞—Å—Ç–µ—Ä–µ.

–õ–∞–±–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –≤ —Ä–∞–º–∫–∞—Ö –∏–∑—É—á–µ–Ω–∏—è Kubernetes –∏ DevOps, —Å —Ü–µ–ª—å—é –ø–æ–Ω—è—Ç—å –∏ –∑–∞–∫—Ä–µ–ø–∏—Ç—å:
- –ø—Ä–∏–Ω—Ü–∏–ø—ã GitOps
- pull-based –¥–µ–ø–ª–æ–π
- —Ä–∞–±–æ—Ç—É ArgoCD –∫–∞–∫ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–ª–∞—Å—Ç–µ—Ä–∞


## üìå –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

–í —Ä–∞–º–∫–∞—Ö –¥–∞–Ω–Ω–æ–π –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ–π —Ä–∞–±–æ—Ç—ã –±—ã–ª —Ä–∞–∑–≤—ë—Ä–Ω—É—Ç Kubernetes-–∫–ª–∞—Å—Ç–µ—Ä –Ω–∞ **Yandex Cloud** —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º **k3s**, –ø–æ—Å–ª–µ —á–µ–≥–æ:

- —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω ArgoCD
- ArgoCD –ø—Ä–∏–≤—è–∑–∞–Ω –∫ Git-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—é
- –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–¥–µ–ø–ª–æ–µ–Ω–æ **–∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ –∏–∑ Git**
- —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω auto-sync –∏ self-heal

**Git —è–≤–ª—è–µ—Ç—Å—è –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–º –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º –ø—Ä–∞–≤–¥—ã (Source of Truth).**

## üß† –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- Kubernetes (k3s)
- ArgoCD
- Git (GitHub)
- YAML manifests
- GitOps

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è  
  
```
.  
‚îú‚îÄ‚îÄ app/  
‚îÇ ‚îú‚îÄ‚îÄ deployment.yaml  
‚îÇ ‚îî‚îÄ‚îÄ service.yaml
‚îú‚îÄ‚îÄ .gitignore
‚îî‚îÄ‚îÄ README.md
```

## ‚öôÔ∏è –ß—Ç–æ —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç—Å—è

### Deployment

- –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ: `nginx`
    
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–ø–ª–∏–∫–∞–º–∏ —á–µ—Ä–µ–∑ Git
    
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è

```
apiVersion: apps/v1
kind: Deployment 
metadata:
  name: demo-app
spec:
  replicas: 3
  selector:
    matchLabels:
      app: demo 
  template:
    metadata:
      labels:
        app: demo 
    spec:
      containers:
      - name: nginx
        image: nginx:1.25
        ports: 
        - containerPort: 80
```
    

### Service

- ClusterIP
    
- –≠–∫—Å–ø–æ–Ω–∏—Ä—É–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤–Ω—É—Ç—Ä–∏ –∫–ª–∞—Å—Ç–µ—Ä–∞

```
apiVersion: v1
kind: Service 
metadata:
  name: demo-service
spec:
  type: ClusterIP
  selector:
    app: demo 
  ports:
  - port: 80
    targetPort: 80
```

## üîÅ GitOps Workflow

1. –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤–Ω–æ—Å—è—Ç—Å—è **—Ç–æ–ª—å–∫–æ –≤ Git**
    
2. ArgoCD –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
    
3. –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ YAML:
    
    - ArgoCD –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–º–µ–Ω—è–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è
        
4. –ï—Å–ª–∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–ª–∞—Å—Ç–µ—Ä–∞ –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç Git:
    
    - ArgoCD –≤—ã–ø–æ–ª–Ω—è–µ—Ç **self-heal**
        

Git ‚Üí ArgoCD ‚Üí Kubernetes

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ ArgoCD

```
kubectl create namespace argocd
kubectl apply -n argocd --server-side --force-conflicts -f https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml
```
–£—Å—Ç–∞–Ω–æ–≤–∏–º ArgoCD –Ω–∞ –Ω–∞—à –∫–ª–∞—Å—Ç–µ—Ä 

<img width="630" height="152" alt="image" src="https://github.com/user-attachments/assets/4c8460dd-3b1a-43b6-97ad-ad4867b2dac2" />
–ü—Ä–æ–≤–µ—Ä–∏–º, —á—Ç–æ —É –Ω–∞—Å –∞–≥–µ–Ω—Ç —É—Å–ø–µ—à–Ω–æ –∑–∞–ø—É—Å—Ç–∏–ª—Å—è 

```
kubectl port-forward --address 0.0.0.0 svc/argocd-server -n argocd 8080:443
```
–ü—Ä–æ–∫–∏–Ω–µ–º –ø–æ—Ä—Ç—ã –Ω–∞—Ä—É–∂—É, –¥–ª—è k3s —ç—Ç–æ —Å–∞–º–æ–µ –±—ã—Å—Ç—Ä–æ–µ —Ä–µ—à–µ–Ω–∏–µ

<img width="696" height="348" alt="image" src="https://github.com/user-attachments/assets/c66081fb-5593-47aa-9a50-5540e48794a4" />

```
http://ip-address:8080
```

```
kubectl get secret argocd-initial-admin-secret \
  -n argocd \
  -o jsonpath="{.data.password}" | base64 -d****
```
–ü–æ–ª—É—á–∏–º–º –ø–∞—Ä–æ–ª—å –¥–ª—è –≤—Ö–æ–¥–∞ –≤ —É—á–µ—Ç–∫—É 

login: admin

<img width="707" height="297" alt="image" src="https://github.com/user-attachments/assets/6d496d4b-88ab-4678-b3dc-ca1666cdefb1" />

–í–æ—Ç —Ç–∞–∫–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –Ω–∞—Å –≤—Å—Ç—Ä–µ—Ç–∏—Ç –≤–Ω—É—Ç—Ä–∏ 

–î–∞–ª–µ–µ –Ω–∞–º –Ω–∞–¥–æ —Å–æ–∑–¥–∞—Ç—å —Ä–µ–ø–æ –Ω–∞ –≥–∏—Ç—Ö–∞–±–µ, –≥–∏—Ç–ª–∞–±–µ, —Å–æ–∑–¥–∞–¥–∏–º —è–º–ª –º–∞–Ω–∏—Ñ–µ—Å—Ç—ã –∏ –∫–∞—Ç–∏–º –¥–∞–ª–µ–µ 

–ñ–º–µ–º –∫–Ω–ø–æ–∫—É Create application –≤ UI –æ—Ç ArgoCd 

<img width="699" height="449" alt="image" src="https://github.com/user-attachments/assets/423abf97-8e78-4b7c-85b3-871d7515a1a9" />

–°–Ω–∞—á–∞–ª–∞ –Ω–∞—Å—Ç—Ä–æ–µ–º auto-sync —Ä–µ–∂–∏–º, —á—Ç–æ GitOps —Ä–∞–±–æ—Ç–∞–ª –∫–∞–∫ –Ω–∞–¥–æ 

<img width="700" height="368" alt="image" src="https://github.com/user-attachments/assets/b86fe6a6-2efa-4c92-859b-4b33cfa0bc4b" />

–î–∞–ª–µ–µ —É–∫–∞–∑—ã–≤–∞–µ–º –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–ª—è –Ω–∞—à–µ–≥–æ ArgoCD

<img width="703" height="271" alt="image" src="https://github.com/user-attachments/assets/615adf83-bdec-4e3c-a47d-085ee5de0788" />

–£–∫–∞–∑—ã–≤–∞–µ–º destination –∏ –∂–º–µ–º Create app

<img width="702" height="577" alt="image" src="https://github.com/user-attachments/assets/5ce33223-cb19-4b9c-8392-d02667085608" />

–°–º–æ—Ç—Ä–∏–º –Ω–∞ –∂—Ç—É –∫—Ä–∞—Å–æ—Ç—É, —É –Ω–∞—Å –≤—Å–µ –≥–æ—Ä–∏—Ç –∑–µ–ª–µ–Ω—ã–º, –∑–Ω–∞—á–∏—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –∑–∞–¥–µ–ø–ª–æ–∏–ª–æ—Å—å

<img width="458" height="93" alt="image" src="https://github.com/user-attachments/assets/23e7aa3b-673d-4bc4-b29b-76e1c3b29dbe" />

–ù–∞ –∫–ª–∞—Å—Ç–µ—Ä–µ –ø—Ä–æ–≤–µ—Ä–∏–º –Ω–∞—à–∏ –º–∞—à–∏–Ω–∫–∏, —É–≤–∏–¥–∏–º —á—Ç–æ –≤—Å–µ —á–µ—Ç–∫–æ 

–î–∞–ª–µ–µ –∏–∑–º–µ–Ω–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–ø–ª–∏–∫ –≤ –º–∞–Ω–∏—Ñ–µ—Å—Ç–µ —Å 2 –¥–æ 3, –∏ –∑–∞–ø—É—à–∏–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ Git –∏ —Å–Ω–æ–≤–∞ –ø—Ä–æ–≤–µ—Ä–∏–º –Ω–∞—à –∫–ª–∞—Å—Ç–µ—Ä 

<img width="457" height="94" alt="image" src="https://github.com/user-attachments/assets/00381efd-8527-427e-aba7-8e8ae782b7a9" />

–ö–∞–∫ –≤–∏–¥–∏–º, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–¥–æ–≤ –≤—ã—Ä–æ—Å–ª–æ –¥–æ 3, –∑–Ω–∞—á–∏—Ç ArgoCD —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∏ —á–µ—Ç–∫–æ 

## üî• –ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

### ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π

- –ö–æ–º–º–∏—Ç –≤ Git
    
- ArgoCD –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–º–µ–Ω—è–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è
    

### ‚úÖ –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ Git

- –ò–∑–º–µ–Ω–µ–Ω–∏–µ `replicas` –≤ `deployment.yaml`
    
- ArgoCD –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
    

### ‚ùå –†—É—á–Ω–æ–µ –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–æ (drift)

- –†—É—á–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–µ–ø–ª–∏–∫ —á–µ—Ä–µ–∑ `kubectl`
    
- ArgoCD –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ
    
- –ö–ª–∞—Å—Ç–µ—Ä –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –∫ —Å–æ—Å—Ç–æ—è–Ω–∏—é –∏–∑ Git
    

## üñ• ArgoCD UI

–í –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ ArgoCD –¥–æ—Å—Ç—É–ø–Ω—ã:

- —Å—Ç–∞—Ç—É—Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (Synced / OutOfSync)
    
- diff –º–µ–∂–¥—É Git –∏ –∫–ª–∞—Å—Ç–µ—Ä–æ–º
    
- –∏—Å—Ç–æ—Ä–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–π
    
- —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ auto-sync
    

## üéØ –¶–µ–ª—å –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ–π —Ä–∞–±–æ—Ç—ã

- –û—Å–≤–æ–∏—Ç—å GitOps-–ø–æ–¥—Ö–æ–¥
    
- –ü–æ–Ω—è—Ç—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É ArgoCD
    
- –ù–∞—É—á–∏—Ç—å—Å—è –¥–µ–ø–ª–æ–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –±–µ–∑ `kubectl apply`
    
- –ó–∞–∫—Ä–µ–ø–∏—Ç—å best practices –ø—Ä–æ–¥–∞–∫—à–Ω-–¥–µ–ø–ª–æ—è
    

## üìé –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ

–í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è **–∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ —á–µ—Ä–µ–∑ Git**, —á—Ç–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç production-–ø–æ–¥—Ö–æ–¥—É –∏ –ø—Ä–∏–Ω—Ü–∏–ø–∞–º DevOps.

## –ê–≤—Ç–æ—Ä –∏ –∫–æ–Ω—Ç–∞–∫—Ç—ã –¥–ª—è —Å–≤—è–∑–∏

#### @Hasler4444 - telegram

#### iluharog@gmail.com - –ø–æ—á—Ç–∞
